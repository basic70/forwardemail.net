# Listmonk із переадресацією електронної пошти для безпечної доставки розсилки {#listmonk-with-forward-email-for-secure-newsletter-delivery}

## Зміст {#table-of-contents}

* [Огляд](#overview)
* [Чому Listmonk та пересилання електронної пошти](#why-listmonk-and-forward-email)
* [Передумови](#prerequisites)
* [Встановлення](#installation)
  * [1. Оновіть свій сервер](#1-update-your-server)
  * [2. Встановлення залежностей](#2-install-dependencies)
  * [3. Завантажте конфігурацію Listmonk](#3-download-listmonk-configuration)
  * [4. Налаштування брандмауера (UFW)](#4-configure-firewall-ufw)
  * [5. Налаштуйте доступ HTTPS](#5-configure-https-access)
  * [6. Запустіть Listmonk](#6-start-listmonk)
  * [7. Налаштуйте SMTP для пересилання електронної пошти в Listmonk](#7-configure-forward-email-smtp-in-listmonk)
  * [8. Налаштування обробки відмов](#8-configure-bounce-processing)
* [Тестування](#testing)
  * [Створіть список розсилки](#create-a-mailing-list)
  * [Додати передплатників](#add-subscribers)
  * [Створити та надіслати кампанію](#create-and-send-a-campaign)
* [Перевірка](#verification)
* [Нотатки розробника](#developer-notes)
* [Висновок](#conclusion)

## Огляд {#overview}

Цей посібник надає розробникам покрокові інструкції щодо налаштування [Лістмонк](https://listmonk.app/), потужного менеджера розсилки та розсилки з відкритим кодом, для використання [Переслати електронний лист](https://forwardemail.net/) як SMTP-провайдера. Таке поєднання дозволяє ефективно керувати вашими кампаніями, забезпечуючи безпечну, конфіденційну та надійну доставку електронної пошти.

* **Listmonk**: Керує підписниками, організує списки розсилки, створює кампанії та відстежує ефективність.
* **Пересилання електронної пошти**: Виконує роль безпечного SMTP-сервера, обробляючи фактичне надсилання електронних листів за допомогою вбудованих функцій безпеки, таких як SPF, DKIM, DMARC та шифрування TLS.

Інтегруючи ці два сервіси, ви зберігаєте повний контроль над своїми даними та інфраструктурою, використовуючи при цьому надійну систему доставки Forward Email.

## Чому Listmonk та пересилання електронної пошти {#why-listmonk-and-forward-email}

* **Відкритий код**: Як Listmonk, так і принципи, що лежать в основі Forward Email, наголошують на прозорості та контролі. Ви самі розміщуєте Listmonk, володіючи своїми даними.
* **Орієнтація на конфіденційність**: Forward Email створено з урахуванням конфіденційності, мінімізуючи зберігання даних та зосереджуючись на безпечній передачі.
* **Економічно ефективний**: Listmonk безкоштовний, а Forward Email пропонує щедрі безкоштовні рівні та доступні платні плани, що робить його бюджетним рішенням.
* **Масштабованість**: Listmonk високопродуктивний, а інфраструктура Forward Email розроблена для надійної доставки у великих масштабах.
* **Зручний для розробників**: Listmonk пропонує надійний API, а Forward Email забезпечує просту інтеграцію SMTP та вебхуки.

## Передумови {#prerequisites}

Перш ніж почати, переконайтеся, що у вас є наступне:

* Віртуальний приватний сервер (VPS) з новим дистрибутивом Linux (рекомендовано Ubuntu 20.04+) з щонайменше 1 процесором та 1 ГБ оперативної пам'яті (рекомендовано 2 ГБ).
* Потрібен провайдер? Перегляньте [рекомендований список VPS](https://github.com/forwardemail/awesome-mail-server-providers).
* Доменне ім'я, яке ви контролюєте (потрібен доступ до DNS).
* Активний обліковий запис з [Переслати електронний лист](https://forwardemail.net/).
* Root-доступ або доступ `sudo` до вашого VPS.
* Базове знайомство з операціями командного рядка Linux.

## Інсталяція {#installation}

Ці кроки допоможуть вам встановити Listmonk за допомогою Docker та Docker Compose на вашому VPS.

### 1. Оновіть свій сервер {#1-update-your-server}

Переконайтеся, що список пакетів вашої системи та встановлені пакети оновлені.

```bash
sudo apt update && sudo apt upgrade -y
```

### 2. Встановлення залежностей {#2-install-dependencies}

Встановіть Docker, Docker Compose та UFW (нескладний брандмауер).

```bash
sudo apt install -y docker.io docker-compose ufw
```

### 3. Завантажити конфігурацію Listmonk {#3-download-listmonk-configuration}

Створіть каталог для Listmonk та завантажте офіційний файл `docker-compose.yml`.

```bash
mkdir listmonk && cd listmonk
curl -Lo docker-compose.yml https://raw.githubusercontent.com/knadh/listmonk/master/docker-compose.yml
```

Цей файл визначає контейнер застосунку Listmonk та необхідний для нього контейнер бази даних PostgreSQL.

### 4. Налаштування брандмауера (UFW) {#4-configure-firewall-ufw}

Дозвольте важливий трафік (SSH, HTTP, HTTPS) через брандмауер. Якщо ваш SSH працює на нестандартному порту, налаштуйте його відповідно.

```bash
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw enable
```

Підтвердіть увімкнення брандмауера, коли з’явиться відповідний запит.

### 5. Налаштування доступу HTTPS {#5-configure-https-access}

Запуск Listmonk через HTTPS є критично важливим для безпеки. У вас є два основні варіанти:

#### Варіант A: Використання проксі-сервера Cloudflare (рекомендовано для спрощення) {#option-a-using-cloudflare-proxy-recommended-for-simplicity}

Якщо DNS вашого домену керується Cloudflare, ви можете скористатися їхньою функцією проксі-сервера для зручного HTTPS.

1. **DNS точки**: Створіть запис `A` у Cloudflare для вашого піддомену Listmonk (наприклад, `listmonk.yourdomain.com`), який вказує на IP-адресу вашого VPS. Переконайтеся, що для параметра **Статус проксі** встановлено значення **Проксовано** (помаранчева хмара).

2. **Змінити Docker Compose**: Відредагуйте завантажений файл `docker-compose.yml`:
```bash
   sed -i 's/9000:9000/80:9000/' docker-compose.yml
   ```
Це зробить Listmonk доступним внутрішньо на порту 80, який Cloudflare потім може проксіювати та захищати за допомогою HTTPS.

#### Варіант B: Використання зворотного проксі-сервера (Nginx, Caddy тощо) {#option-b-using-a-reverse-proxy-nginx-caddy-etc}

Або ж ви можете налаштувати зворотний проксі-сервер, такий як Nginx або Caddy, на вашому VPS для обробки HTTPS-завершення та проксі-запитів до Listmonk (за замовчуванням працює на порту 9000).

* Залиште значення `ports: - "127.0.0.1:9000:9000"` за замовчуванням у `docker-compose.yml`, щоб забезпечити доступ до Listmonk лише локально.
* Налаштуйте вибраний зворотний проксі-сервер для прослуховування портів 80 та 443, обробки отримання SSL-сертифіката (наприклад, через Let's Encrypt) та переадресації трафіку на `http://127.0.0.1:9000`.
* Детальне налаштування зворотного проксі-сервера виходить за рамки цього посібника, але багато навчальних посібників доступні в Інтернеті.

### 6. Запустіть Listmonk {#6-start-listmonk}

Поверніться до каталогу `listmonk` (якщо ви ще там не перебуваєте) та запустіть контейнери в окремому режимі.

```bash
cd ~/listmonk # Or the directory where you saved docker-compose.yml
docker compose up -d
```

Docker завантажить необхідні образи та запустить застосунок Listmonk і контейнери бази даних. Першого разу це може зайняти хвилину-дві.

✅ **Доступ до Listmonk**: Тепер ви маєте змогу отримати доступ до веб-інтерфейсу Listmonk через налаштований вами домен (наприклад, `https://listmonk.yourdomain.com`).

### 7. Налаштування пересилання електронної пошти через SMTP у Listmonk {#7-configure-forward-email-smtp-in-listmonk}

Далі налаштуйте Listmonk для надсилання електронних листів, використовуючи ваш обліковий запис Forward Email.

1. **Увімкніть SMTP у пересиланні електронної пошти**: Переконайтеся, що ви створили облікові дані SMTP на панелі керування обліковим записом пересилання електронної пошти. Виконайте дії [Посібник з пересилання електронної пошти для надсилання електронної пошти з користувацьким доменом через SMTP](https://forwardemail.net/en/guides/send-email-with-custom-domain-smtp), якщо ви ще цього не зробили.
2. **Налаштуйте Listmonk**: Увійдіть до панелі адміністратора Listmonk.
* Перейдіть до **Налаштування -> SMTP**.

* Listmonk має вбудовану підтримку пересилання електронної пошти. Виберіть **ForwardEmail** зі списку постачальників або вручну введіть такі дані:

| Налаштування | Значення |
| :---------------- | :------------------------------------------------------------------------------------------------------------------ |
| **Хост** | `smtp.forwardemail.net` |
| **Порт** | `465` |
| **Протокол автентифікації** | `LOGIN` |
| **Ім'я користувача** | Ваша електронна адреса для пересилання **Ім'я користувача SMTP** |
| **Пароль** | Ваш переадресаційний електронний лист **SMTP-пароль** |
| **TLS** | `SSL/TLS` |
| **З електронної пошти** | Ваша бажана адреса `From` (наприклад, `newsletter@yourdomain.com`). Переконайтеся, що цей домен налаштовано в розділі «Пересилання електронної пошти». |

* **Важливо**: Завжди використовуйте порт `465` з `SSL/TLS` для безпечних з’єднань із пересиланням електронної пошти. Не використовуйте STARTTLS (порт 587).

* Натисніть **Зберегти**.
3. **Надіслати тестовий електронний лист**: Натисніть кнопку «Надіслати тестовий електронний лист» на сторінці налаштувань SMTP. Введіть адресу одержувача, до якої ви маєте доступ, і натисніть **Надіслати**. Переконайтеся, що електронний лист надійшов до поштової скриньки одержувача.

### 8. Налаштування обробки відмов {#8-configure-bounce-processing}

Обробка відмов дозволяє Listmonk автоматично обробляти електронні листи, які не вдалося доставити (наприклад, через недійсні адреси). Пересилання електронної пошти надає вебхук для сповіщення Listmonk про відмову.

#### Налаштування пересилання електронної пошти {#forward-email-setup}

1. Увійдіть у свій обліковий запис [Панель керування пересиланням електронної пошти](https://forwardemail.net/).
2. Перейдіть до розділу **Домени**, виберіть домен, який ви використовуєте для надсилання, і перейдіть на сторінку **Налаштування**.
3. Прокрутіть униз до розділу **URL-адреса відхилення вебхука**.
4. Введіть наступну URL-адресу, замінивши `<your_listmonk_domain>` фактичним доменом або піддоменом, де доступний ваш екземпляр Listmonk:
```sh
   https://<your_listmonk_domain>/webhooks/service/forwardemail
   ```
*Приклад*: `https://listmonk.yourdomain.com/webhooks/service/forwardemail`
5. Прокрутіть далі до розділу **Ключ перевірки корисного навантаження підпису вебхука**.
6. **Скопіюйте** згенерований ключ перевірки. Він знадобиться вам у Listmonk.
7. Збережіть зміни в налаштуваннях домену пересилання електронної пошти.

#### Налаштування Listmonk {#listmonk-setup}

1. У панелі адміністратора Listmonk перейдіть до **Налаштування -> Відмовлення**.

2. Увімкніть **Увімкнути обробку відмов**.

3. Увімкніть **Увімкнути вебхуки відмов**.

4. Прокрутіть униз до розділу **Постачальники вебхуків**.

5. Увімкніть **Пересилання електронної пошти**.

6. Вставте **Ключ перевірки корисного навантаження підпису вебхука**, який ви скопіювали з панелі інструментів пересилання електронної пошти, у поле **Ключ пересилання електронної пошти**.

7. Натисніть **Зберегти** внизу сторінки.

8. Обробку відмов тепер налаштовано! Коли функція пересилання електронної пошти виявить відмову для електронного листа, надісланого Listmonk, вона повідомить ваш екземпляр Listmonk через вебхук, і Listmonk відповідно позначить підписника.

9. Виконайте наведені нижче кроки в [Тестування](#testing), щоб переконатися, що все працює.

## Тестування {#testing}

Ось короткий огляд основних функцій Listmonk:

### Створити список розсилки {#create-a-mailing-list}

* Перейдіть до **Списків** на бічній панелі.
* Натисніть **Новий список**.
* Заповніть дані (Назва, Тип: Публічний/Приватний, Опис, Теги) та **Зберегти**.

### Додати підписників {#add-subscribers}

* Перейдіть до розділу **Підписники**.
* Ви можете додати підписників:
* **Вручну**: Натисніть **Новий підписник**.
* **Імпорт**: Натисніть **Імпорт підписників**, щоб завантажити файл CSV.
* **API**: Використовуйте API Listmonk для програмного додавання.
* Призначте підписників одному або кільком спискам під час створення або імпорту.
* **Найкраща практика**: Використовуйте процес подвійної підписки. Налаштуйте це в розділі **Налаштування -> Підписка та підписки**.

### Створити та надіслати кампанію {#create-and-send-a-campaign}

* Перейдіть до **Кампанії** -> **Нова кампанія**.
* Заповніть деталі кампанії (Ім'я, Тема, Ел. пошта відправника, Список(и) для надсилання).
* Виберіть тип контенту (Rich Text/HTML, Звичайний текст, Необроблений HTML).
* Створіть контент електронного листа. Ви можете використовувати змінні шаблону, такі як `{{ .Subscriber.Email }}` або `{{ .Subscriber.FirstName }}`.
* **Завжди спочатку надсилайте тестовий лист!** Використовуйте опцію «Надіслати тестовий лист», щоб переглянути лист у своїй поштовій скриньці. * Якщо ви задоволені результатами, натисніть **Розпочати кампанію**, щоб надіслати його негайно або запланувати на потім.

## Підтвердження {#verification}

* **Доставка SMTP**: Регулярно надсилайте тестові електронні листи через сторінку налаштувань SMTP Listmonk та тестуйте кампанії, щоб переконатися, що листи доставлені правильно.
* **Обробка відмов**: Надсилайте тестову кампанію на відому недійсну адресу електронної пошти (наприклад, `bounce-test@yourdomain.com`, якщо у вас немає справжньої під рукою, хоча результати можуть відрізнятися). Перевірте статистику кампанії в Listmonk через деякий час, щоб побачити, чи зареєстровано відмову.
* **Заголовки електронних листів**: Використовуйте такі інструменти, як [Тестер пошти](https://www.mail-tester.com/), або перевіряйте заголовки електронних листів вручну, щоб переконатися, що SPF, DKIM та DMARC проходять успішну перевірку, що вказує на правильне налаштування пересилання електронної пошти.
* **Журнали пересилання електронної пошти**: Перевірте журнали панелі інструментів пересилання електронної пошти, якщо підозрюєте, що проблеми з доставкою виникають через SMTP-сервер.

## Нотатки розробника {#developer-notes}

* **Шаблони**: Listmonk використовує механізм шаблонів Go. Перегляньте його документацію для розширеної персоналізації: `{{ .Subscriber.Attribs.your_custom_field }}`.
* **API**: Listmonk надає комплексний REST API для керування списками, підписниками, кампаніями, шаблонами тощо. Посилання на документацію API можна знайти в нижньому колонтитулі вашого екземпляра Listmonk.
* **Налаштовувані поля**: Визначте власні поля підписників у розділі **Налаштування -> Поля підписників** для зберігання додаткових даних.
* **Вебхуки**: Окрім відмов, Listmonk може надсилати вебхуки для інших подій (наприклад, підписок), що дозволяє інтеграцію з іншими системами.

## Висновок {#conclusion}

Інтегруючи можливості Listmonk, що самостійно розміщується, з безпечною та конфіденційною доставкою переадресації електронної пошти, ви створюєте надійну та етичну платформу email-маркетингу. Ви зберігаєте повне право власності на дані своєї аудиторії, отримуючи при цьому переваги високої доставляльності та автоматизованих функцій безпеки.

Ця конфігурація забезпечує масштабовану, економічно ефективну та зручну для розробників альтернативу власницьким поштовим сервісам, що ідеально відповідає принципам програмного забезпечення з відкритим кодом та конфіденційності користувачів.

Щасливого відправлення! 🚀