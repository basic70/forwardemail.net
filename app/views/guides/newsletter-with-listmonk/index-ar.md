# Listmonk مع إعادة توجيه البريد الإلكتروني لتسليم النشرة الإخبارية بشكل آمن {#listmonk-with-forward-email-for-secure-newsletter-delivery}

## جدول المحتويات {#table-of-contents}

* [ملخص](#overview)
* [لماذا Listmonk وإعادة توجيه البريد الإلكتروني](#why-listmonk-and-forward-email)
* [المتطلبات الأساسية](#prerequisites)
* [تثبيت](#installation)
  * [1. تحديث الخادم الخاص بك](#1-update-your-server)
  * [2. تثبيت التبعيات](#2-install-dependencies)
  * [3. تنزيل تكوين Listmonk](#3-download-listmonk-configuration)
  * [4. تكوين جدار الحماية (UFW)](#4-configure-firewall-ufw)
  * [5. تكوين الوصول عبر HTTPS](#5-configure-https-access)
  * [6. ابدأ Listmonk](#6-start-listmonk)
  * [7. تكوين إعادة توجيه البريد الإلكتروني SMTP في Listmonk](#7-configure-forward-email-smtp-in-listmonk)
  * [8. تكوين معالجة الارتداد](#8-configure-bounce-processing)
* [الاختبار](#testing)
  * [إنشاء قائمة بريدية](#create-a-mailing-list)
  * [إضافة المشتركين](#add-subscribers)
  * [إنشاء حملة وإرسالها](#create-and-send-a-campaign)
* [تَحَقّق](#verification)
* [ملاحظات المطور](#developer-notes)
* [خاتمة](#conclusion)

## نظرة عامة على {#overview}

يقدم هذا الدليل للمطورين تعليمات خطوة بخطوة لإعداد [قائمة مونك](https://listmonk.app/)، وهو برنامج قوي مفتوح المصدر لإدارة النشرات الإخبارية وقوائم البريد، لاستخدام [إعادة توجيه البريد الإلكتروني](https://forwardemail.net/) كمزود SMTP. يتيح لك هذا المزيج إدارة حملاتك بفعالية مع ضمان تسليم بريد إلكتروني آمن وخاص وموثوق.

* **Listmonk**: يتولى إدارة المشتركين، وتنظيم القوائم، وإنشاء الحملات، وتتبع الأداء.
* **إعادة توجيه البريد الإلكتروني**: يعمل كخادم SMTP آمن، ويتولى الإرسال الفعلي لرسائل البريد الإلكتروني باستخدام ميزات أمان مدمجة مثل SPF وDKIM وDMARC وتشفير TLS.

من خلال دمج هذين النظامين، يمكنك الاحتفاظ بالتحكم الكامل في بياناتك وبنيتك الأساسية مع الاستفادة من نظام التسليم القوي الخاص بـ Forward Email.

## لماذا Listmonk وإعادة توجيه البريد الإلكتروني {#why-listmonk-and-forward-email}

* **مفتوح المصدر**: يُركز كلٌّ من Listmonk والمبادئ التي يقوم عليها Forward Email على الشفافية والتحكم. أنت تستضيف Listmonk بنفسك، وتملك بياناتك.
* **مُركّز على الخصوصية**: صُمّم Forward Email مع مراعاة الخصوصية في جوهره، مما يُقلّل من الاحتفاظ بالبيانات ويُركّز على النقل الآمن.
* **فعال من حيث التكلفة**: Listmonk مجاني، بينما يُقدّم Forward Email باقات مجانية سخية وباقات مدفوعة بأسعار معقولة، مما يجعله حلاً اقتصاديًا.
* **قابلية التوسع**: يتميز Listmonk بأداء عالٍ، وصُمّمت البنية التحتية لـ Forward Email لتوفير توصيل موثوق به على نطاق واسع.
* **مناسب للمطورين**: يُقدّم Listmonk واجهة برمجة تطبيقات قوية، ويُوفّر Forward Email تكاملاً مباشرًا مع SMTP وخطافات ويب.

## المتطلبات الأساسية {#prerequisites}

قبل أن تبدأ، تأكد من أن لديك ما يلي:

* خادم افتراضي خاص (VPS) يعمل بنظام لينكس حديث (يُنصح باستخدام أوبونتو 20.04+) مزود بمعالج واحد على الأقل وذاكرة وصول عشوائي (RAM) بسعة 1 جيجابايت (يُنصح باستخدام 2 جيجابايت).
* هل تحتاج إلى مزود خدمة؟ تحقق من [قائمة VPS الموصى بها](https://github.com/forwardemail/awesome-mail-server-providers).
* اسم نطاق تتحكم به (يتطلب الوصول إلى DNS).
* حساب نشط بصلاحية [إعادة توجيه البريد الإلكتروني](https://forwardemail.net/).
* صلاحية الوصول إلى VPS بحساب الجذر أو `sudo`.
* إلمام أساسي بعمليات سطر أوامر لينكس.

## تثبيت {#installation}

ترشدك هذه الخطوات خلال عملية تثبيت Listmonk باستخدام Docker وDocker Compose على VPS الخاص بك.

### 1. تحديث الخادم الخاص بك {#1-update-your-server}

تأكد من أن قائمة حزم النظام لديك والحزم المثبتة محدثة.

```bash
sudo apt update && sudo apt upgrade -y
```

### 2. تثبيت التبعيات {#2-install-dependencies}

قم بتثبيت Docker وDocker Compose وUFW (جدار الحماية غير المعقد).

```bash
sudo apt install -y docker.io docker-compose ufw
```

### 3. تنزيل تكوين Listmonk {#3-download-listmonk-configuration}

قم بإنشاء دليل لـ Listmonk وقم بتنزيل الملف الرسمي `docker-compose.yml`.

```bash
mkdir listmonk && cd listmonk
curl -Lo docker-compose.yml https://raw.githubusercontent.com/knadh/listmonk/master/docker-compose.yml
```

يقوم هذا الملف بتعريف حاوية تطبيق Listmonk وحاوية قاعدة بيانات PostgreSQL المطلوبة لها.

### 4. تكوين جدار الحماية (UFW) {#4-configure-firewall-ufw}

اسمح بمرور البيانات الأساسية (SSH، HTTP، HTTPS) عبر جدار الحماية. إذا كان منفذ SSH يعمل على منفذ غير قياسي، فاضبطه وفقًا لذلك.

```bash
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw enable
```

قم بتأكيد تمكين جدار الحماية عند مطالبتك بذلك.

### 5. تكوين وصول HTTPS {#5-configure-https-access}

يُعد تشغيل Listmonk عبر HTTPS أمرًا بالغ الأهمية للأمان. لديك خياران رئيسيان:

#### الخيار أ: استخدام وكيل Cloudflare (موصى به للبساطة) {#option-a-using-cloudflare-proxy-recommended-for-simplicity}

إذا كان DNS الخاص بنطاقك يُدار بواسطة Cloudflare، فيمكنك الاستفادة من ميزة الوكيل الخاصة بهم لتسهيل استخدام HTTPS.

١. **نقطة DNS**: أنشئ سجل `A` في Cloudflare لنطاقك الفرعي Listmonk (مثل `listmonk.yourdomain.com`) مشيرًا إلى عنوان IP الخاص بخادم VPS. تأكد من ضبط **حالة الوكيل** على **مُوَجَّه** (سحابة برتقالية).
٢. **تعديل Docker Compose**: عدّل ملف `docker-compose.yml` الذي نزّلته:
```bash
   sed -i 's/9000:9000/80:9000/' docker-compose.yml
   ```
هذا يجعل Listmonk متاحًا داخليًا على المنفذ ٨٠، والذي يمكن لـ Cloudflare بعد ذلك استخدامه كوكيل وتأمينه باستخدام HTTPS.

#### الخيار ب: استخدام وكيل عكسي (Nginx، Caddy، إلخ.) {#option-b-using-a-reverse-proxy-nginx-caddy-etc}

بدلاً من ذلك، يمكنك إعداد وكيل عكسي مثل Nginx أو Caddy على VPS الخاص بك للتعامل مع إنهاء HTTPS وطلبات الوكيل إلى Listmonk (يعمل على المنفذ 9000 بشكل افتراضي).

* احتفظ بالقيمة الافتراضية `ports: - "127.0.0.1:9000:9000"` في `docker-compose.yml` لضمان إمكانية الوصول إلى Listmonk محليًا فقط.
* قم بتكوين الوكيل العكسي الذي اخترته للاستماع على المنفذين 80 و443، ومعالجة الحصول على شهادات SSL (مثلًا، عبر Let's Encrypt)، وإعادة توجيه حركة المرور إلى `http://127.0.0.1:9000`.
* إعداد الوكيل العكسي المفصل يتجاوز نطاق هذا الدليل، ولكن تتوفر العديد من الدروس التعليمية على الإنترنت.

### 6. ابدأ Listmonk {#6-start-listmonk}

انتقل مرة أخرى إلى دليل `listmonk` (إذا لم تكن هناك بالفعل) وابدأ تشغيل الحاويات في الوضع المنفصل.

```bash
cd ~/listmonk # Or the directory where you saved docker-compose.yml
docker compose up -d
```

سيقوم Docker بتنزيل الصور اللازمة وبدء تشغيل تطبيق Listmonk وحاويات قاعدة البيانات. قد يستغرق الأمر دقيقة أو دقيقتين في المرة الأولى.

✅ **الوصول إلى Listmonk**: يجب أن تتمكن الآن من الوصول إلى واجهة الويب Listmonk عبر المجال الذي قمت بتكوينه (على سبيل المثال، `https://listmonk.yourdomain.com`).

### 7. تكوين إعادة توجيه البريد الإلكتروني SMTP في Listmonk {#7-configure-forward-email-smtp-in-listmonk}

بعد ذلك، قم بتكوين Listmonk لإرسال رسائل البريد الإلكتروني باستخدام حساب إعادة توجيه البريد الإلكتروني الخاص بك.

١. **تفعيل SMTP في إعادة توجيه البريد الإلكتروني**: تأكد من إنشاء بيانات اعتماد SMTP في لوحة معلومات حساب إعادة توجيه البريد الإلكتروني. اتبع [دليل إعادة توجيه البريد الإلكتروني لإرسال البريد الإلكتروني باستخدام نطاق مخصص عبر SMTP](https://forwardemail.net/en/guides/send-email-with-custom-domain-smtp) إذا لم تكن قد فعلت ذلك بالفعل.

٢. **تهيئة Listmonk**: سجّل الدخول إلى لوحة إدارة Listmonk.
* انتقل إلى **الإعدادات -> SMTP**.

* يدعم Listmonk إعادة توجيه البريد الإلكتروني. اختر **إعادة توجيه البريد الإلكتروني** من قائمة مزودي الخدمة، أو أدخل التفاصيل التالية يدويًا:

| جلسة | قيمة |
| :---------------- | :------------------------------------------------------------------------------------------------------------------ |
| **يستضيف** | `smtp.forwardemail.net` |
| **ميناء** | `465` |
| **بروتوكول المصادقة** | `LOGIN` |
| **اسم المستخدم** | بريدك الإلكتروني لإعادة التوجيه **اسم مستخدم SMTP** |
| **كلمة المرور** | بريدك الإلكتروني المعاد توجيهه **كلمة مرور SMTP** |
| **TLS** | `SSL/TLS` |
| **من البريد الإلكتروني** | عنوان `From` المطلوب (مثلًا، `newsletter@yourdomain.com`). تأكد من تكوين هذا النطاق في إعادة توجيه البريد الإلكتروني. |

* **هام**: استخدم دائمًا المنفذ `465` مع `SSL/TLS` للاتصالات الآمنة مع إعادة توجيه البريد الإلكتروني. لا تستخدم STARTTLS (المنفذ 587).

* انقر على **حفظ**.
3. **إرسال بريد إلكتروني تجريبي**: استخدم زر "إرسال بريد إلكتروني تجريبي" في صفحة إعدادات SMTP. أدخل عنوان المستلم الذي يمكنك الوصول إليه، ثم انقر على **إرسال**. تأكد من وصول البريد الإلكتروني إلى صندوق الوارد الخاص بالمستلم.

### 8. تكوين معالجة الارتداد {#8-configure-bounce-processing}

تتيح معالجة الارتدادات لـ Listmonk التعامل تلقائيًا مع رسائل البريد الإلكتروني التي تعذّر تسليمها (مثلاً، بسبب عناوين غير صالحة). يوفر إعادة توجيه البريد الإلكتروني رابطًا ويب لإخطار Listmonk بالارتدادات.

#### إعداد إعادة توجيه البريد الإلكتروني {#forward-email-setup}

١. سجّل الدخول إلى [لوحة معلومات إعادة توجيه البريد الإلكتروني](https://forwardemail.net/).
٢. انتقل إلى **النطاقات**، وحدد النطاق الذي تستخدمه للإرسال، ثم انتقل إلى صفحة **الإعدادات**.
٣. مرر للأسفل إلى قسم **عنوان URL لخطاف الويب المرتد**.
٤. أدخل عنوان URL التالي، مع استبدال `<your_listmonk_domain>` بالنطاق الفعلي أو النطاق الفرعي الذي يمكن الوصول إليه من خلاله إلى مثيل Listmonk الخاص بك:
```sh
   https://<your_listmonk_domain>/webhooks/service/forwardemail
   ```
*مثال*: `https://listmonk.yourdomain.com/webhooks/service/forwardemail`
٥. مرر للأسفل إلى قسم **مفتاح التحقق من حمولة توقيع خطاف الويب**.
٦. **انسخ** مفتاح التحقق المُولّد. ستحتاجه في Listmonk.
٧. احفظ التغييرات في إعدادات نطاق إعادة توجيه البريد الإلكتروني.

#### إعداد Listmonk {#listmonk-setup}

١. في لوحة إدارة Listmonk، انتقل إلى **الإعدادات ← الارتدادات**.
٢. فعّل **معالجة الارتدادات**.
٣. فعّل **تفعيل خطافات الويب للارتداد**.
٤. مرر للأسفل إلى قسم **موفرو خطافات الويب**.
٥. فعّل **إعادة توجيه البريد الإلكتروني**.
٦. الصق **مفتاح التحقق من حمولة توقيع خطاف الويب** الذي نسخته من لوحة معلومات إعادة توجيه البريد الإلكتروني في حقل **مفتاح إعادة توجيه البريد الإلكتروني**.
٧. انقر على **حفظ** أسفل الصفحة.
٨. تم الآن تهيئة معالجة الارتدادات! عندما يكتشف خيار إعادة توجيه البريد الإلكتروني ارتدادًا لرسالة بريد إلكتروني مرسلة من Listmonk، فسيُعلم مثيل Listmonk الخاص بك عبر خطاف الويب، وسيُحدد Listmonk المشترك وفقًا لذلك.
٩. أكمل الخطوات أدناه في [الاختبار](#testing) للتأكد من أن كل شيء يعمل بشكل صحيح.

## اختبار {#testing}

فيما يلي نظرة عامة سريعة على وظائف Listmonk الأساسية:

### إنشاء قائمة بريدية {#create-a-mailing-list}

* انتقل إلى **القوائم** في الشريط الجانبي.
* انقر على **قائمة جديدة**.
* أدخل التفاصيل (الاسم، النوع: عام/خاص، الوصف، الوسوم) ثم **احفظ**.

### إضافة المشتركين {#add-subscribers}

* انتقل إلى قسم **المشتركين**.
* يمكنك إضافة مشتركين:
* **يدويًا**: انقر على **مشترك جديد**.
* **استيراد**: انقر على **استيراد المشتركين** لتحميل ملف CSV.
* **واجهة برمجة التطبيقات**: استخدم واجهة برمجة تطبيقات Listmonk للإضافات البرمجية.
* عيّن المشتركين إلى قائمة واحدة أو أكثر أثناء الإنشاء أو الاستيراد.
* **أفضل ممارسة**: استخدم عملية الاشتراك المزدوج. قم بتكوين هذه الميزة من **الإعدادات -> الاشتراك والاشتراكات**.

### إنشاء حملة وإرسالها {#create-and-send-a-campaign}

* انتقل إلى **الحملات** -> **حملة جديدة**.
* أدخل تفاصيل الحملة (الاسم، الموضوع، عنوان البريد الإلكتروني، القائمة/القوائم) المُراد إرسالها إليها).
* اختر نوع المحتوى (نص منسق/HTML، نص عادي، HTML خام).
* أنشئ محتوى رسالتك الإلكترونية. يمكنك استخدام متغيرات القالب مثل `{{ .Subscriber.Email }}` أو `{{ .Subscriber.FirstName }}`.
* **أرسل دائمًا رسالة تجريبية أولًا!** استخدم خيار "إرسال رسالة تجريبية" لمعاينة الرسالة في بريدك الوارد.
* بعد الانتهاء، انقر على **بدء الحملة** لإرسالها فورًا أو جدولتها لاحقًا.

## التحقق من {#verification}

* **تسليم SMTP**: أرسل رسائل بريد إلكتروني تجريبية بانتظام عبر صفحة إعدادات SMTP في Listmonk، واختبر الحملات لضمان تسليمها بشكل صحيح.
* **معالجة الارتداد**: أرسل حملة بريد إلكتروني تجريبية إلى عنوان بريد إلكتروني معروف بأنه غير صالح (مثل `bounce-test@yourdomain.com` إذا لم يكن لديك عنوان بريد إلكتروني حقيقي، مع العلم أن النتائج قد تختلف). تحقق من إحصائيات الحملة في Listmonk بعد فترة قصيرة لمعرفة ما إذا كان الارتداد مسجلاً.
* **رؤوس البريد الإلكتروني**: استخدم أدوات مثل [اختبار البريد](https://www.mail-tester.com/) أو افحص رؤوس البريد الإلكتروني يدويًا للتحقق من نجاح SPF وDKIM وDMARC، مما يشير إلى الإعداد الصحيح من خلال إعادة توجيه البريد الإلكتروني.
* **سجلات إعادة توجيه البريد الإلكتروني**: تحقق من سجلات لوحة معلومات إعادة توجيه البريد الإلكتروني إذا كنت تشك في وجود مشاكل في التسليم ناجمة عن خادم SMTP.

## ملاحظات المطور {#developer-notes}

* **القوالب**: يستخدم Listmonk محرك قوالب Go. استكشف وثائقه للتخصيص المتقدم: `{{ .Subscriber.Attribs.your_custom_field }}`.
* **واجهة برمجة التطبيقات**: يوفر Listmonk واجهة برمجة تطبيقات REST شاملة لإدارة القوائم والمشتركين والحملات والقوالب وغيرها. ابحث عن رابط وثائق واجهة برمجة التطبيقات في تذييل نسخة Listmonk.
* **الحقول المخصصة**: حدد حقول المشتركين المخصصة ضمن **الإعدادات -> حقول المشتركين** لتخزين بيانات إضافية.
* **خطافات الويب**: بالإضافة إلى الرسائل المرتدة، يمكن لـ Listmonk إرسال خطافات ويب لأحداث أخرى (مثل الاشتراكات)، مما يسمح بالتكامل مع أنظمة أخرى.

## الاستنتاج {#conclusion}

بدمج قوة الاستضافة الذاتية من Listmonk مع خدمة Forward Email الآمنة والمحترمة للخصوصية، ستُنشئ منصة تسويق بريد إلكتروني قوية وأخلاقية. ستحتفظ بملكية كاملة لبيانات جمهورك، مع الاستفادة من قابلية توصيل عالية وميزات أمان آلية.

يوفر هذا الإعداد بديلاً قابلاً للتطوير وفعّالاً من حيث التكلفة وصديقًا للمطورين لخدمات البريد الإلكتروني الاحتكارية، وهو يتماشى تمامًا مع مبادئ البرمجيات مفتوحة المصدر وخصوصية المستخدم.

إرسال سعيد! 🚀